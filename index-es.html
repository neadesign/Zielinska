<!DOCTYPE html>
<html lang="es">
<head>
<link rel="shortcut icon" href="https://raw.githubusercontent.com/neadesign/Zielinska/refs/heads/main/favicon.png">

<style>
  #toastOverlay {
    display: none;
    position: fixed;
    top: 40%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0,0,0,0.85);
    color: #fff;
    padding: 20px 30px;
    border-radius: 10px;
    font-size: 16px;
    z-index: 10000;
    text-align: center;
  }
</style>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Playfair+Display:ital,wght@0,600;1,500&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Inter', sans-serif;
  }
  h1 {
    font-family: 'Playfair Display', serif;
    font-weight: 600;
    font-size: 28px;
  }
  h1 em {
    font-family: 'Playfair Display', serif;
    font-weight: 500;
    font-size: 18px;
    color: #666;
  }
</style>

<style>
  body {
    font-family: 'Lato', sans-serif;
    background-color: #fefefe;
    margin: 0;
    padding: 20px;
    color: #333;
  }
  h1 {
    font-size: 28px;
    margin-bottom: 0;
  }
  h1 em {
    font-size: 18px;
    color: #666;
    display: block;
    margin-top: 5px;
  }
  .menu-header {
    text-align: center;
    margin-bottom: 30px;
  }
  .gallery {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin: 20px auto 40px auto;
    max-width: 1000px;
  }
  .gallery-item {
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    overflow: hidden;
    text-align: center;
    font-size: 14px;
    padding: 8px;
    transition: transform 0.3s ease;
  }
  .gallery-item:hover {
    transform: scale(1.02);
  }
  .gallery-item img {
    width: 100%;
    height: 160px;
    object-fit: cover;
    border-radius: 6px;
  }
  button {
    padding: 12px 20px;
    font-size: 14px;
    border-radius: 8px;
    border: none;
    margin: 5px;
    cursor: pointer;
    transition: 0.2s ease;
  }
  button:hover {
    opacity: 0.9;
  }
  .primary-btn {
    background-color: #0077cc;
    color: white;
  }
  .green-btn {
    background-color: #27ae60;
    color: white;
  }
  .summary-box {
    background: #f5f5f5;
    border-radius: 10px;
    padding: 15px;
    white-space: pre-line;
    font-size: 14px;
    margin-top: 20px;
  }
  .form-row {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }
  .form-row > label {
    flex: 1;
    min-width: 200px;
    max-width: 100%;
    flex: 1;
    min-width: 200px;
  }
</style>

  <meta charset="UTF-8">
  <title>Pedido Neaspace</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f9f9f9; }
    .menu-container { max-width: 800px; margin: auto; background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    h1 { text-align: center; font-style: italic; color: #444; }
    .btn-container { display: flex; justify-content: center; gap: 20px; margin: 20px 0; }
    .formule-block { border: 1px solid #ccc; padding: 10px; margin-bottom: 15px; border-radius: 8px; background: #f1f1f1; position: relative; }
    .remove-btn { position: absolute; top: 10px; right: 10px; background: red; color: white; border: none; border-radius: 50%; padding: 5px 10px; cursor: pointer; }
    button { padding: 10px 20px; font-size: 16px; border-radius: 6px; background-color: #0077cc; color: white; border: none; cursor: pointer; }
    #orderSummary { background: #eee; padding: 10px; margin-top: 20px; white-space: pre-line; border-radius: 6px; }
  </style>
  <style>
  select.formule-select {
    font-size: 13px;
    padding: 4px 6px;
    max-width: 160px;
  }
</style>
  <style>
  select, input[type="date"], input[type="tel"] {
    height: 38px;
    box-sizing: border-box;
  }
</style>

</head>
<body>
<div id="toastOverlay">Gracias, ser√° redirigido a la p√°gina de pago‚Ä¶</div>
<div class="menu-container">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
  <img src="https://le-de.cdn-website.com/8bc9f943e09f48bb852cb048d9ca0a57/dms3rep/multi/opt/Senza-titolo-230w.png" alt="Nea logo" style="height: 50px; object-fit: contain;">
  <div style="text-align: center; flex: 1; margin: 0 20px;">
    <h1 style="margin: 0; font-style: italic;">Tu men√∫</h1>
    <em style="font-size: 16px;">en colaboraci√≥n con Zielinska</em>
  </div>
  <img src="https://delicity.b-cdn.net/public/merchants/fournil-zielinska/logo/dOX32S57QSm0SibS_200x200.jpg" alt="Zielinska logo" style="height: 50px; border-radius: 8px; object-fit: cover;">
</div>

<div class="formule-hero" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; max-width: 800px; margin: 0 auto 30px auto;">
  <div class="formule-hero-item" style="background: #fff; padding: 10px; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); text-align:center;">
    <img src="https://raw.githubusercontent.com/neadesign/Zielinska/refs/heads/main/petdej.png" alt="Formule Petit-d√©j" style="width:100%; height:250px; object-fit:cover; border-radius:12px; margin-bottom:10px;">
    <div><strong>F√≥rmula Desayuno</strong><br>1 boller√≠a, 1 caf√© (a elegir: leche normal, avena o soja), 1 zumo de naranja reci√©n exprimido  
<em>Un despertar suave con sabores artesanales.</em></div>
  </div>
  <div class="formule-hero-item" style="background: #fff; padding: 10px; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); text-align:center;">
    <img src="https://raw.githubusercontent.com/neadesign/Zielinska/refs/heads/main/formbrunch.png" alt="Formule Brunch" style="width:100%; height:250px; object-fit:cover; border-radius:12px; margin-bottom:10px;">
    <div><strong>F√≥rmula Brunch</strong><br>Tostada de aguacate, pan, mantequilla y mermelada, granola, bebida caliente (a elegir: caf√© o espresso), zumo de naranja reci√©n exprimido  
<em>Un brunch generoso para empezar el d√≠a con placer.</em></div>
  </div>
</div>
<div class="gallery" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px auto; max-width: 1000px;">
  <div class="gallery-item" style="text-align: center; font-size: 14px; color: #333; padding: 10px; background: #fff; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);">
    <img src="https://raw.githubusercontent.com/neadesign/Zielinska/refs/heads/main/avoto.png" alt="Avocado toast" style="width: 100%; height: 180px; object-fit: cover; border-radius: 8px;">
    Tostada de aguacate ‚Äì rebanada generosa con aguacate fresco
  </div>
  <div class="gallery-item" style="text-align: center; font-size: 14px; color: #333; padding: 10px; background: #fff; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);">
    <img src="https://raw.githubusercontent.com/neadesign/Zielinska/refs/heads/main/panbeur.png" alt="Pain, beurre et confiture" style="width: 100%; height: 180px; object-fit: cover; border-radius: 8px;">
    Pan / Mantequilla / Mermelada ‚Äì cl√°sico de la ma√±ana
  </div>
  <div class="gallery-item" style="text-align: center; font-size: 14px; color: #333; padding: 10px; background: #fff; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);">
  <img src="https://raw.githubusercontent.com/neadesign/Zielinska/refs/heads/main/babka.jpeg" alt="Babka chocolat" style="width: 100%; height: 180px; object-fit: cover; border-radius: 8px;">
  Babka de chocolate ‚Äì brioche trenzado con un coraz√≥n muy chocolatoso. ¬°Delicioso y nunca demasiado dulce!
</div>
<div class="gallery-item" style="text-align: center; font-size: 14px; color: #333; padding: 10px; background: #fff; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);">
  <img src="https://raw.githubusercontent.com/neadesign/Zielinska/refs/heads/main/roule.jpeg" alt="Roul√© cannelle" style="width: 100%; height: 180px; object-fit: cover; border-radius: 8px;">
  Rollo de canela ‚Äì brioche de masa madre con canela. ¬°Nuestro best-seller que hay que probar!
</div>
  <div class="gallery-item" style="text-align: center; font-size: 14px; color: #333; padding: 10px; background: #fff; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);">
    <img src="https://raw.githubusercontent.com/neadesign/Zielinska/refs/heads/main/panbri.png" alt="Brioche, omelette, bacon" style="width: 100%; height: 180px; object-fit: cover; border-radius: 8px;">
    Tortilla y bacon sobre pan brioche ‚Äì un tr√≠o salado y sabroso
  </div>
  <div class="gallery-item" style="text-align: center; font-size: 14px; color: #333; padding: 10px; background: #fff; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);">
    <img src="https://raw.githubusercontent.com/neadesign/Zielinska/refs/heads/main/granola.png" alt="Granola" style="width: 100%; height: 180px; object-fit: cover; border-radius: 8px;">
    Granola
  </div>
  <div class="gallery-item" style="text-align: center; font-size: 14px; color: #333; padding: 10px; background: #fff; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);">
    <img src="https://raw.githubusercontent.com/neadesign/Zielinska/refs/heads/main/juisbio1.png" alt="Jus d‚Äôorange bio" style="width: 100%; height: 180px; object-fit: cover; border-radius: 8px;">
    Zumo de naranja exprimido ‚Äì 100% ecol√≥gico y reci√©n exprimido
  </div>
</div>

<div id="nextUnavailable" style="margin-bottom: 15px; font-style: italic; color: #aa0000;"></div>
<form id="orderForm">
  <div style="display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 20px;">
    <label style="flex: 1 1 250px; min-width: 200px;">Fecha de entrega:
      <input type="date" id="deliveryDate" name="delivery_date" required style="width: 100%; padding: 6px;">
    </label>

    <label style="flex: 1 1 250px; min-width: 200px;">Hora: 
      <select name="delivery_time" required style="width: 100%; padding: 6px;"> 
        <option value="">Seleccionar</option> 
        <option>07:30</option><option>08:00</option><option>08:30</option> 
        <option>09:00</option><option>09:30</option><option>10:00</option> 
      </select> 
    </label>

    <label style="flex: 1 1 250px; min-width: 200px;">WhatsApp: 
      <input type="tel" name="whatsapp" required placeholder="+34 6..." style="width: 100%; padding: 6px;"> 
    </label>
  </div>

  <div class="btn-container">
    <button type="button" onclick="addFormula('petitdej')">+ A√±adir f√≥rmula Desayuno</button>
    <button type="button" onclick="addFormula('brunch')">+ A√±adir f√≥rmula Brunch</button>
  </div>
<div id="formuleContainer"></div>

<div style="margin-top: 40px;">
  <h2>Suplementos</h2>
  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px;">
    <label style="display: flex; justify-content: space-between; align-items: center;">
      Tostada de aguacate 16.5 ‚Ç¨
      <input type="number" name="addon_avocado" min="0" max="5" value="0" style="width: 35px; margin-left: 10px;">
    </label>

    <label style="display: flex; justify-content: space-between; align-items: center;">
      Pan/Mantequilla/Mermelada 9.5 ‚Ç¨
      <input type="number" name="addon_pain" min="0" max="5" value="0" style="width: 35px; margin-left: 10px;">
    </label>

    <label style="display: flex; justify-content: space-between; align-items: center;">
      Tortilla y bacon en pan brioche 10 ‚Ç¨
      <input type="number" name="addon_brioche" min="0" max="5" value="0" style="width: 35px; margin-left: 10px;">
    </label>

    <label style="display: flex; justify-content: space-between; align-items: center;">
      Granola 12.5 ‚Ç¨
      <input type="number" name="addon_granola" min="0" max="5" value="0" style="width: 35px; margin-left: 10px;">
    </label>

    <label style="display: flex; justify-content: space-between; align-items: center;">
      Zumo de naranja exprimido 6.5 ‚Ç¨
      <input type="number" name="addon_jus" min="0" max="5" value="0" style="width: 35px; margin-left: 10px;">
    </label>

    <label style="display: flex; justify-content: space-between; align-items: center;">
      Caf√© 4 ‚Ç¨
      <input type="number" name="addon_cafe" min="0" max="5" value="0" style="width: 35px; margin-left: 10px;">
    </label>

    <label style="display: flex; justify-content: space-between; align-items: center;">
      Espresso 4.0 ‚Ç¨
      <input type="number" name="addon_espresso" min="0" max="5" value="0" style="width: 35px; margin-left: 10px;">
    </label>

    <label style="display: flex; justify-content: space-between; align-items: center;">
      Latte (normal) 6.5 ‚Ç¨
      <input type="number" name="addon_latte_normal" min="0" max="5" value="0" style="width: 35px; margin-left: 10px;">
    </label>

    <label style="display: flex; justify-content: space-between; align-items: center;">
      Latte (avena) 6.5 ‚Ç¨
      <input type="number" name="addon_latte_avoine" min="0" max="5" value="0" style="width: 35px; margin-left: 10px;">
    </label>

    <label style="display: flex; justify-content: space-between; align-items: center;">
      Latte (soja) 6.5 ‚Ç¨
      <input type="number" name="addon_latte_soja" min="0" max="5" value="0" style="width: 35px; margin-left: 10px;">
    </label>
  </div>

  <p style="margin-top: 20px; font-style: italic; color: #666;">* Entrega y tarifa de servicio 9 ‚Ç¨ (incluye 7,50 ‚Ç¨ por entrega v√≠a Delicity y 1,50 ‚Ç¨ por gesti√≥n del pedido).</p>
</div>

<button type="button" onclick="generateSummary()">üß∫ A√±adir al carrito</button>
<pre id="orderSummary" style="display:none; background:#eee; padding:15px; margin-top:20px; border-radius:8px;"></pre>
<button type="submit">‚úÖ Pagar</button>

</form>
</div>
<script>
let formuleId = 0;

function addFormula(type) {
  console.log("A√±adir f√≥rmula", type);
  formuleId++;
  const div = document.createElement('div');
  div.className = 'formule-block';
  div.id = 'formule_' + formuleId;
  let html = '<button class="remove-btn" onclick="removeFormula(\'' + div.id + '\')">√ó</button>';
  
  if (type === 'petitdej') {
    html += `<strong>Desayuno ‚Äì 17 ‚Ç¨</strong><br>
    <label>Elige boller√≠a:
      <select class="formule-select" name="petitdej_${formuleId}_viennoiserie">
        <option value="">Seleccionar</option>
        <option value="Roul√©e">Rollo</option>
        <option value="Babka">Babka</option>
        <option value="Brioche">Brioche</option>
      </select>
    </label><br>
    <label>Tipo de leche:
      <select class="formule-select" name="petitdej_${formuleId}_lait">
        <option value="">Seleccionar</option>
        <option value="Lait normal">Leche normal</option>
        <option value="Lait d‚Äôavoine">Leche de avena</option>
        <option value="Lait de soja">Leche de soja</option>
      </select>
    </label>`;
  } else {
    html += `<strong>Brunch ‚Äì 50 ‚Ç¨</strong><br>
    <label>Bebida caliente:
      <select class="formule-select" name="brunch_${formuleId}">
        <option value="">Seleccionar</option>
        <option value="Caf√©">Caf√©</option>
        <option value="Espresso">Espresso</option>
      </select>
    </label>`;
  }

  div.innerHTML += html;
  document.getElementById('formuleContainer').appendChild(div);
}

function removeFormula(id) {
  const el = document.getElementById(id);
  if (el) el.remove();
}

function generateSummary() {
  const dateInput = document.querySelector('[name="delivery_date"]').value;
  const timeInput = document.querySelector('[name="delivery_time"]').value;
  const phoneInput = document.querySelector('[name="whatsapp"]').value;

  if (isInvalid(dateInput)) {
    alert("‚ùå Esta fecha no est√° disponible. Por favor, elige otra.");
    return;
  }


  if (!dateInput || !timeInput || !phoneInput) {
    alert("Por favor, rellena la fecha, hora y n√∫mero de WhatsApp.");
    return;
  }

  const today = new Date();
  const deliveryDate = new Date(dateInput + 'T00:00:00');
  const now = new Date();
  const isSameDay = today.toDateString() === deliveryDate.toDateString();
  const isTomorrow = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 1).toDateString() === deliveryDate.toDateString();
  const currentHour = now.getHours();

  if (isSameDay) {
    setTimeout(() => {
      alert("‚ùå Los pedidos deben hacerse el d√≠a anterior antes de las 18h. Por favor, elige otra fecha.");
    }, 5000);
    return;
  }

  if (isTomorrow && currentHour >= 18) {
    setTimeout(() => {
      alert("‚ùå Es demasiado tarde para pedir para ma√±ana. Los pedidos cierran a las 18h del d√≠a anterior.");
    }, 5000);
    return;
  }

  let summary = `üìÖ Entrega: ${dateInput} a las ${timeInput}
üìç Direcci√≥n: 19 Rue Neuve, Niza ‚Äì 2¬∫ piso, puerta a la derecha (üîî Rossi-Lamrabet)
üì± Contacto: ${phoneInput}
`;

  let total = 0;
  const prix = { petitdej: 17, brunch: 50 };

  document.querySelectorAll('.formule-block').forEach(block => {
    const selects = block.querySelectorAll('select');

    if (block.querySelector('select[name^="petitdej"]')) {
      const viennoiserie = selects[0]?.value || 'no especificado';
      const lait = selects[1]?.value || 'no especificado';

      summary += `\nF√≥rmula Desayuno ‚Äì 17 ‚Ç¨:\n` +
                 `- Boller√≠a: ${viennoiserie}\n` +
                 `- Caf√©: ${lait}\n` +
                 `- Zumo de naranja exprimido\n`;
      total += prix.petitdej;
    }

    if (block.querySelector('select[name^="brunch"]')) {
      const boisson = selects[0]?.value || 'no especificado';

      summary += `\nF√≥rmula Brunch ‚Äì 50 ‚Ç¨:\n` +
                 `- Tostada de aguacate\n` +
                 `- Pan, mantequilla y mermelada\n` +
                 `- Granola\n` +
                 `- Bebida caliente: ${boisson}\n` +
                 `- Zumo de naranja exprimido\n`;
      total += prix.brunch;
    }
  });

  const addons = [
    ["addon_avocado", "Tostada de aguacate", 16.5],
    ["addon_pain", "Pan / Mantequilla / Mermelada", 9.5],
    ["addon_brioche", "Tortilla y bacon en pan brioche", 10],
    ["addon_granola", "Granola", 12.5],
    ["addon_jus", "Zumo de naranja exprimido ecol√≥gico", 6.5],
    ["addon_cafe", "Caf√©", 4],
    ["addon_espresso", "Espresso", 4.0],
    ["addon_latte_normal", "Latte (normal)", 6.5],
    ["addon_latte_avoine", "Latte (avena)", 6.5],
    ["addon_latte_soja", "Latte (soja)", 6.5]
  ];

  addons.forEach(([name, label, price]) => {
    const el = document.querySelector(`[name="${name}"]`);
    if (!el) return;

    const qty = parseInt(el.value || 0);
    if (qty > 0) {
      summary += `${label} (${price} ‚Ç¨) ‚Äì Cantidad: ${qty}\n`;
      total += qty * price;
    }
  });
  summary += `\nüöö Entrega: 7,50 ‚Ç¨ a trav√©s de nuestro socio Delicity`;
summary += `\nüßæ Tarifa de servicio y gesti√≥n: 1,50 ‚Ç¨ (pago, embalaje, atenci√≥n al cliente)`;
total += 7.5 + 1.5;
summary += `\nüí∞ Total: ${total.toFixed(2)} ‚Ç¨`;

  document.getElementById('orderSummary').style.display = 'block';
  document.getElementById('orderSummary').textContent = summary;
}
function generateStripeSummary() {
  const summary = document.getElementById("orderSummary").textContent;
  const maxLength = 500;

  if (summary.length <= maxLength) {
    return summary;
  }

  const date = document.querySelector('[name="delivery_date"]').value;
  const time = document.querySelector('[name="delivery_time"]').value;
  const phone = document.querySelector('[name="whatsapp"]').value;
  const count = document.querySelectorAll('.formule-block').length;

  return `Fecha: ${date} ${time}, Cliente: ${phone}, F√≥rmulas: ${count}, Total: ${summary.match(/Total: ([\d.,]+)/)?.[1]} ‚Ç¨`;
}
function generateSummaryFr() {
  const date = document.querySelector('[name="delivery_date"]').value;
  const time = document.querySelector('[name="delivery_time"]').value;
  const phone = document.querySelector('[name="whatsapp"]').value;
  let total = 0;

  let summaryFr = `üìÖ Livraison : ${date} √† ${time}
üìç Adresse : 19 Rue Neuve, Nice ‚Äì 2e √©tage, porte √† droite (üîî Rossi-Lamrabet)
üì± Contact : ${phone}
`;

  document.querySelectorAll('.formule-block').forEach(block => {
    if (block.querySelector('select[name^="petitdej"]')) {
      summaryFr += `\nFormule Petit-d√©j ‚Äì 17 ‚Ç¨\n`;
      summaryFr += `- Viennoiserie : ${block.querySelector('select[name$="_viennoiserie"]').value || 'non pr√©cis√©'}\n`;
      summaryFr += `- Lait : ${block.querySelector('select[name$="_lait"]').value || 'non pr√©cis√©'}\n`;
      summaryFr += `- Jus d‚Äôorange press√©\n`;
      total += 17;
    }
    if (block.querySelector('select[name^="brunch"]')) {
      summaryFr += `\nFormule Brunch ‚Äì 50 ‚Ç¨\n`;
      summaryFr += `- Avocado toast\n`;
      summaryFr += `- Pain, beurre et confiture\n`;
      summaryFr += `- Granola\n`;
      summaryFr += `- Boisson chaude : ${block.querySelector('select[name^="brunch"]').value || 'non pr√©cis√©e'}\n`;
      summaryFr += `- Jus d‚Äôorange press√©\n`;
      total += 50;
    }
  });

  const addons = [
    ["addon_avocado",      "Avocado toast",                        16.5],
    ["addon_pain",         "Pain / Beurre / Confiture",             9.5],
    ["addon_brioche",      "Omelette et bacon sur pain brioch√©",   10.0],
    ["addon_granola",      "Granola",                              12.5],
    ["addon_jus",          "Jus d‚Äôorange press√© bio",               6.5],
    ["addon_cafe",         "Caf√©",                                  4.0],
    ["addon_espresso",     "Espresso",                              4.0],
    ["addon_latte_normal", "Latte (classique)",                    6.5],
    ["addon_latte_avoine", "Latte (avoine)",                       6.5],
    ["addon_latte_soja",   "Latte (soja)",                         6.5]
  ];
  addons.forEach(([name, label, price]) => {
    const el = document.querySelector(`[name="${name}"]`);
    const qty = el ? parseInt(el.value, 10) || 0 : 0;
    if (qty > 0) {
      summaryFr += `${label} (${price} ‚Ç¨) ‚Äì Quantit√© : ${qty}\n`;
      total += qty * price;
    }
  });

  summaryFr += `\nüöö Livraison avec suppl√©ment de 7 ‚Ç¨ via Delicity.`;
  total += 7;
  summaryFr += `\nüí∞ Total : ${total.toFixed(2)} ‚Ç¨`;

  return summaryFr;
}
function generateSummaryEs() {
  const date = document.querySelector('[name="delivery_date"]').value;
  const time = document.querySelector('[name="delivery_time"]').value;
  const phone = document.querySelector('[name="whatsapp"]').value;
  let total = 0;

  let summaryEs = `üìÖ Entrega: ${date} a las ${time}
üìç Direcci√≥n: 19 Rue Neuve, Niza ‚Äì 2.¬∫ piso, puerta de la derecha (üîî Rossi-Lamrabet)
üì± Contacto: ${phone}
`;

  // F√≥rmulas
  document.querySelectorAll('.formule-block').forEach(block => {
    if (block.querySelector('select[name^="petitdej"]')) {
      summaryEs += `\nF√≥rmula Desayuno ‚Äì 17 ‚Ç¨\n`;
      summaryEs += `- Boller√≠a: ${block.querySelector('select[name$="_viennoiserie"]').value || 'no especificada'}\n`;
      summaryEs += `- Leche: ${block.querySelector('select[name$="_lait"]').value || 'no especificada'}\n`;
      summaryEs += `- Zumo de naranja exprimido\n`;
      total += 17;
    }
    if (block.querySelector('select[name^="brunch"]')) {
      summaryEs += `\nF√≥rmula Brunch ‚Äì 50 ‚Ç¨\n`;
      summaryEs += `- Tostada de aguacate\n`;
      summaryEs += `- Pan, mantequilla y mermelada\n`;
      summaryEs += `- Granola\n`;
      summaryEs += `- Bebida caliente: ${block.querySelector('select[name^="brunch"]').value || 'no especificada'}\n`;
      summaryEs += `- Zumo de naranja exprimido\n`;
      total += 50;
    }
  });

  // Complementos
  const addons = [
    ["addon_avocado",      "Tostada de aguacate",                       16.5],
    ["addon_pain",         "Pan/Mantequilla/Mermelada",                  9.5],
    ["addon_brioche",      "Tortilla con bacon en brioche",             10.0],
    ["addon_granola",      "Granola",                                   12.5],
    ["addon_jus",          "Zumo de naranja exprimido bio",             6.5],
    ["addon_cafe",         "Caf√©",                                       4.0],
    ["addon_espresso",     "Espresso",                                   4.0],
    ["addon_latte_normal", "Latte (normal)",                            6.5],
    ["addon_latte_avoine", "Latte (avena)",                             6.5],
    ["addon_latte_soja",   "Latte (soja)",                              6.5]
  ];
  addons.forEach(([name, label, price]) => {
    const el = document.querySelector(`[name="${name}"]`);
    const qty = el ? parseInt(el.value, 10) || 0 : 0;
    if (qty > 0) {
      summaryEs += `${label} (${price} ‚Ç¨) ‚Äì Cantidad: ${qty}\n`;
      total += qty * price;
    }
  });

  // Env√≠o y total
  summary += `\nüöö Entrega: 7,50 ‚Ç¨ a trav√©s de nuestro socio Delicity`;
summary += `\nüßæ Tarifa de servicio y gesti√≥n: 1,50 ‚Ç¨ (pago, embalaje, atenci√≥n al cliente)`;
total += 7.5 + 1.5;
summary += `\nüí∞ Total: ${total.toFixed(2)} ‚Ç¨`;

  return summaryEs;
}
  
document.getElementById("orderForm").addEventListener("submit", function(e) {
  e.preventDefault();
  const summary = document.getElementById("orderSummary").textContent;
  const totalMatch = summary.match(/Total: ([\d.,]+)/) || summary.match(/üí∞ Total: ([\d.,]+)/);
  const total = totalMatch ? parseFloat(totalMatch[1].replace(',', '.')) : 0;

  const toast = document.getElementById('toastOverlay');
  toast.style.display = 'block';
  setTimeout(() => { toast.style.display = 'none'; }, 8000);

  fetch('https://zielinska.onrender.com/create-checkout-session', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      total,
      phone: document.querySelector('[name="whatsapp"]').value,
      delivery_date: document.querySelector('[name="delivery_date"]').value,
      orderDetailsShort: generateStripeSummary(),
      orderDetailsLong: summary
    })
  })
  .then(res => res.json())
  .then(data => {
    if (data.url) {
      window.location.href = data.url;
    } else {
      alert("‚ùå El pago no est√° disponible actualmente. Por favor, int√©ntalo m√°s tarde.");
    }
  })
  .catch(err => {
    console.error("‚ùå Error con Stripe:", err);
    alert("‚ùå Ha ocurrido un error durante el pago.");
  });
});

</script>

<script>
window.addEventListener('DOMContentLoaded', async () => {
  const dateInput = document.getElementById('deliveryDate');
  let dateTimeout;
  dateInput.addEventListener('input', () => {
    clearTimeout(dateTimeout);
    dateTimeout = setTimeout(() => {
      const selectedDate = dateInput.value;
      if (isInvalid(selectedDate)) {
        alert("‚ùå Esta fecha no est√° disponible. Por favor, elige otra.");
        dateInput.value = "";
      }
    }, 8000); // retardo de 0.8 segundos
  });

  await fetchUnavailableDates();
});
</script>

<script>
const START_DATE = new Date("2025-05-23");
const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vScTm1j0tp3F7h89bhmLGqEJr4nlJuqPCPm8j57qn3xqFfIYk3Mf89KXRWqbxzmxA/pub?output=csv";

let unavailableDatesFromSheet = [];

async function fetchUnavailableDates() {
  try {
    const response = await fetch(sheetUrl);
    const text = await response.text();
    const rows = text.split('\n');
    unavailableDatesFromSheet = rows
      .map(row => row.trim())
      .filter(r => r.match(/^\d{4}-\d{2}-\d{2}$/));
  } catch (err) {
    console.error("‚ùå Error al cargar las fechas bloqueadas:", err);
  }
}

function isWednesday(dateStr) {
  const d = new Date(dateStr);
  return d.getDay() === 3;
}

function isInvalid(dateStr) {
  const d = new Date(dateStr);
  return (
    isNaN(d) ||
    d < START_DATE ||
    isWednesday(dateStr) ||
    unavailableDatesFromSheet.includes(dateStr)
  );
}

function formatDateShort(dateStr) {
  const d = new Date(dateStr);
  return d.toLocaleDateString('es-ES', {
    day: 'numeric',
    month: 'short'
  });
}

async function showNextUnavailable() {
  await fetchUnavailableDates();

  const result = [];
  const today = new Date();
  let date = new Date(today.getFullYear(), today.getMonth(), today.getDate());

  while (result.length < 3) {
    const iso = date.toISOString().split('T')[0];
    if (isInvalid(iso)) result.push(formatDateShort(iso));
    date.setDate(date.getDate() + 1);
  }

  document.getElementById("nextUnavailable").textContent =
    `‚ö†Ô∏è Pr√≥ximas fechas no disponibles: ${result.join(', ')}`;
}

document.addEventListener("DOMContentLoaded", showNextUnavailable);
</script>

</body>
</html>
