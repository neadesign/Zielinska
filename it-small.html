<!DOCTYPE html>

<html lang="it">
<head>
<link href="https://raw.githubusercontent.com/neadesign/Zielinska/refs/heads/main/favicon.png" rel="shortcut icon"/>
<style>
  #toastOverlay {
    display: none;
    position: fixed;
    top: 40%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0,0,0,0.85);
    color: #fff;
    padding: 20px 30px;
    border-radius: 10px;
    font-size: 16px;
    z-index: 10000;
    text-align: center;
  }
</style>
<meta charset="UTF-8">
<title>Ordine Neaspace</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Playfair+Display:ital,wght@0,600;1,500&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Inter', sans-serif;
    background-color: #fefefe;
    margin: 0;
    padding: 20px;
    color: #333;
  }
  h1 {
    font-family: 'Playfair Display', serif;
    font-weight: 600;
    font-size: 28px;
  }
  h1 em {
    font-family: 'Playfair Display', serif;
    font-weight: 500;
    font-size: 18px;
    color: #666;
  }
</style>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script src="https://js.stripe.com/v3/"></script>

</head>
<body>
<div class="menu-container">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
    <img src="https://le-de.cdn-website.com/8bc9f943e09f48bb852cb048d9ca0a57/dms3rep/multi/opt/Senza-titolo-230w.png" alt="Nea logo" style="height: 50px; object-fit: contain;">
    <div style="text-align: center; flex: 1; margin: 0 20px;">
      <h1 style="margin: 0; font-style: italic;">Il tuo menù</h1>
      <em style="font-size: 16px;">in collaborazione con Zielinska</em>
    </div>
    <img src="https://delicity.b-cdn.net/public/merchants/fournil-zielinska/logo/dOX32S57QSm0SibS_200x200.jpg" alt="Zielinska logo" style="height: 50px; border-radius: 8px; object-fit: cover;">
  </div>

  <div class="formule-hero" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; max-width: 800px; margin: 0 auto 30px auto;">
    <div class="formule-hero-item" style="background: #fff; padding: 10px; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); text-align:center;">
      <img src="https://raw.githubusercontent.com/neadesign/Zielinska/refs/heads/main/petdej.png" alt="Formule Petit-déj" style="width:100%; height:250px; object-fit:cover; border-radius:12px; margin-bottom:10px;">
      <div><strong>Formula Colazione</strong><br>1 viennoiserie, Caffè latte a scelta: normale, avena o soia), 1 spremuta d’arancia  
      <em>Un risveglio delicato, dai sapori artigianali.</em></div>
    </div>
    <div class="formule-hero-item" style="background: #fff; padding: 10px; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); text-align:center;">
      <img src="https://raw.githubusercontent.com/neadesign/Zielinska/refs/heads/main/formbrunch.png" alt="Formule Brunch" style="width:100%; height:250px; object-fit:cover; border-radius:12px; margin-bottom:10px;">
      <div><strong>Formula Brunch</strong><br>Avocado toast, pane, burro e marmellata, granola, bevanda calda (a scelta: caffè o espresso), spremuta d’arancia  
      <em>Un brunch generoso per iniziare la giornata con piacere.</em></div>
    </div>
  </div>

  <div class="gallery" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px auto; max-width: 1000px;">
    <div class="gallery-item"><img src="https://raw.githubusercontent.com/neadesign/Zielinska/refs/heads/main/avoto.png" alt="Avocado toast" style="width: 100%; height: 180px; object-fit: cover; border-radius: 8px;">Avocado toast – fetta generosa con avocado fresco</div>
    <div class="gallery-item"><img src="https://raw.githubusercontent.com/neadesign/Zielinska/refs/heads/main/panbeur.png" alt="Pain, beurre et confiture" style="width: 100%; height: 180px; object-fit: cover; border-radius: 8px;">Pane / Burro / Marmellata – classico del mattino</div>
    <div class="gallery-item"><img src="https://raw.githubusercontent.com/neadesign/Zielinska/refs/heads/main/babka.jpeg" alt="Babka chocolat" style="width: 100%; height: 180px; object-fit: cover; border-radius: 8px;">Babka al cioccolato – brioche intrecciata con cuore al cioccolato. Deliziosa e mai troppo dolce!</div>
    <div class="gallery-item"><img src="https://raw.githubusercontent.com/neadesign/Zielinska/refs/heads/main/roule.jpeg" alt="Roulé cannelle" style="width: 100%; height: 180px; object-fit: cover; border-radius: 8px;">Roulé alla cannella – brioche al lievito madre con cannella. Il nostro best-seller assoluto!</div>
    <div class="gallery-item"><img src="https://raw.githubusercontent.com/neadesign/Zielinska/refs/heads/main/panbri.png" alt="Brioche, omelette, bacon" style="width: 100%; height: 180px; object-fit: cover; border-radius: 8px;">Omelette e bacon su pane brioché – un trio salato e goloso</div>
    <div class="gallery-item"><img src="https://raw.githubusercontent.com/neadesign/Zielinska/refs/heads/main/granola.png" alt="Granola" style="width: 100%; height: 180px; object-fit: cover; border-radius: 8px;">Granola</div>
    <div class="gallery-item"><img src="https://raw.githubusercontent.com/neadesign/Zielinska/refs/heads/main/juisbio1.png" alt="Jus d’orange bio" style="width: 100%; height: 180px; object-fit: cover; border-radius: 8px;">Succo d’arancia spremuto – 100% bio e appena spremuto</div>
  </div>
</div>
<div style="margin-top: 40px;">
<h2>Supplementi</h
2>
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px;">
<label style="display: flex; justify-content: space-between; align-items: center;">
    Avocado toast 0.17 € €
    <input max="5" min="0" name="addon_avocado" style="width: 35px; margin-left: 10px;" type="number" value="0"/>
</label>
<label style="display: flex; justify-content: space-between; align-items: center;">
    Pane/Burro/Marmellata 0.10 € €
    <input max="5" min="0" name="addon_pain" style="width: 35px; margin-left: 10px;" type="number" value="0"/>
</label>
<label style="display: flex; justify-content: space-bet
ween; align-items: center;">
    Omelette e bacon su pane brioché 0.10 € €
    <input max="5" min="0" name="addon_brioche" style="width: 35px; margin-left: 10px;" type="number" value="0"/>
</label>
<label style="display: flex; justify-content: space-between; align-items: center;">
    Granola 0.12 € €
    <input max="5" min="0" name="addon_granola" style="width: 35px; margin-left: 10px;" type="number" value="0"/>
</label>
<label style="display: flex; justify-content: space-between; align-items: center;">
    Succo d’arancia spremuto 0.07 € €
    <input max="5" min="0" name="addon_jus" style="width: 35px; margin-left: 10px;" 
type="number" value="0"/>
</label>
<label style="display: flex; justify-content: space-between; align-items: center;">
    Caffè 0.04 € €
    <input max="5" min="0" name="addon_cafe" style="width: 35px; margin-left: 10px;" type="number" value="0"/>
</label>
<label style="display: flex; justify-content: space-between; align-items: center;">
    Espresso 0.04 € €
    <input max="5" min="0" name="addon_espresso" style="width: 35px; margin-left: 10px;" type="number" value="0"/>
</label>
<label style="display: flex; justify-content: space-between; align-items: center;">
    Latte (normale) 0.07 € €
    <input max="5" min="0" name
="addon_latte_normal" style="width: 35px; margin-left: 10px;" type="number" value="0"/>
</label>
<label style="display: flex; justify-content: space-between; align-items: center;">
    Latte (avena) 0.07 € €
    <input max="5" min="0" name="addon_latte_avoine" style="width: 35px; margin-left: 10px;" type="number" value="0"/>
</label>
<label style="display: flex; justify-content: space-between; align-items: center;">
    Latte (soia) 0.07 € €
    <input max="5" min="0" name="addon_latte_soja" style="width: 35px; margin-left: 10px;" type="number" value="0"/>
</label>
</div>
</div>
<form id="orderForm">
  <div style="display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 20px;">
    <label style="flex: 1 1 250px; min-width: 200px;">Data di consegna:
      <input type="date" id="deliveryDate" name="delivery_date" required style="width: 100%; padding: 6px;">
    </label>

    <label style="flex: 1 1 250px; min-width: 200px;">Ora:
      <select name="delivery_time" required style="width: 100%; padding: 6px;">
        <option value="">Seleziona</option>
        <option>08:00</option><option>08:15</option><option>08:30</option>
        <option>08:45</option><option>09:00</option><option>09:15</option>
        <option>09:30</option><option>09:45</option><option>10:00</option>
        <option>10:15</option><option>10:30</option><option>11:00</option>
        <option>11:30</option><option>12:00</option>
      </select>
    </label>

    <label style="flex: 1 1 250px; min-width: 200px;">WhatsApp:
      <input type="tel" name="whatsapp" required placeholder="+33 6..." style="width: 100%; padding: 6px;">
    </label>
  </div>

  <div class="btn-container">
    <button type="button" onclick="addFormula('petitdej')">+ Aggiungi una formula Colazione</button>
    <button type="button" onclick="addFormula('brunch')">+ Aggiungi una formula Brunch</button>
  </div>

  <div id="formuleContainer"></div>

  <p style="margin-top: 20px; font-style: italic; color: #666;">* Consegna e servizio: 0.09 € (includono 0.075 € per la consegna tramite Delicity e 0.015 € per la gestione dell’ordine).</p>

  <button type="button" onclick="generateSummary()">🧺 Aggiungi al carrello</button>
  <pre id="orderSummary" style="display:none; background:#eee; padding:15px; margin-top:20px; border-radius:8px;"></pre>
  <button type="submit">✅ Pagamento</button>

  <div style="margin-top: 15px; text-align: center; font-size: 14px; color: #555;">
    🔒 <strong>Pagamento sicuro con Stripe</strong><br>
    <img src="https://stripe.com/img/v3/home/social.png" alt="Logo Stripe" style="height: 24px; margin-top: 5px;">
  </div>
</form>

<div id="toastOverlay">Grazie, verrai reindirizzato alla pagina di pagamento…</div>
<script>
let formuleId = 0;

function addFormula(type) {
  formuleId++;
  const div = document.createElement('div');
  div.className = 'formule-block';
  div.id = 'formule_' + formuleId;
  let html = '<button class="remove-btn" onclick="removeFormula(\'' + div.id + '\')">×</button>';

  if (type === 'petitdej') {
    html += `<strong>Colazione – 0.17 €</strong><br>
    <label>Scelta viennoiserie:
      <select class="formule-select" name="petitdej_${formuleId}_viennoiserie">
        <option value="">Seleziona</option>
        <option value="Roulée">Rotolo alla cannella</option>
        <option value="Babka">Babka</option>
        <option value="Brioche">Brioche</option>
      </select>
    </label><br>
    <label>Tipo di latte:
      <select class="formule-select" name="petitdej_${formuleId}_lait">
        <option value="">Seleziona</option>
        <option value="Latte normale">Latte normale</option>
        <option value="Latte avena">Latte di avena</option>
        <option value="Latte soia">Latte di soia</option>
      </select>
    </label>`;
  } else {
    html += `<strong>Brunch – 0.50 €</strong><br>
    <label>Bevanda calda:
      <select class="formule-select" name="brunch_${formuleId}">
        <option value="">Seleziona</option>
        <option value="Caffè">Caffè</option>
        <option value="Espresso">Espresso</option>
      </select>
    </label>`;
  }

  div.innerHTML += html;
  document.getElementById('formuleContainer').appendChild(div);
}

function removeFormula(id) {
  const el = document.getElementById(id);
  if (el) el.remove();
}

function generateSummary() {
  const date = document.querySelector('[name="delivery_date"]').value;
  const time = document.querySelector('[name="delivery_time"]').value;
  const phone = document.querySelector('[name="whatsapp"]').value;

  if (!date || !time || !phone) {
    alert("Per favore compila la data, l'ora e il numero WhatsApp.");
    return;
  }

  let total = 0;
  let summary = `📅 Consegna: ${date} alle ${time}
📍 Indirizzo: 19 Rue Neuve, Nizza – 2° piano, porta a destra (🔔 Rossi-Lamrabet)
📱 Contatto: ${phone}
`;

  document.querySelectorAll('.formule-block').forEach(block => {
    if (block.querySelector('select[name^="petitdej"]')) {
      summary += `\nFormula Colazione – 0.17 €\n`;
      summary += `- Viennoiserie: ${block.querySelector('select[name$="_viennoiserie"]').value || 'non specificato'}\n`;
      summary += `- Latte: ${block.querySelector('select[name$="_lait"]').value || 'non specificato'}\n`;
      summary += `- Spremuta d’arancia\n`;
      total += 0.17;
    }
    if (block.querySelector('select[name^="brunch"]')) {
      summary += `\nFormula Brunch – 0.50 €\n`;
      summary += `- Avocado toast\n`;
      summary += `- Pane, burro e marmellata\n`;
      summary += `- Granola\n`;
      summary += `- Bevanda calda: ${block.querySelector('select[name^="brunch"]').value || 'non specificato'}\n`;
      summary += `- Spremuta d’arancia\n`;
      total += 0.50;
    }
  });

  const addons = [
    ["addon_avocado", "Avocado toast", 0.17],
    ["addon_pain", "Pane/Burro/Marmellata", 0.10],
    ["addon_brioche", "Omelette e bacon", 0.10],
    ["addon_granola", "Granola", 0.12],
    ["addon_jus", "Succo d’arancia", 0.07],
    ["addon_cafe", "Caffè", 0.04],
    ["addon_espresso", "Espresso", 0.04],
    ["addon_latte_normal", "Latte (normale)", 0.07],
    ["addon_latte_avoine", "Latte (avena)", 0.07],
    ["addon_latte_soja", "Latte (soia)", 0.07]
  ];

  addons.forEach(([name, label, price]) => {
    const el = document.querySelector(`[name="${name}"]`);
    const qty = el ? parseInt(el.value, 10) || 0 : 0;
    if (qty > 0) {
      summary += `${label} (${price} €) – Quantità: ${qty}\n`;
      total += qty * price;
    }
  });

  summary += `\n🚚 Consegna: 0.075 € (Delicity)`;
  summary += `\n📦 Servizio: 0.015 €`;
  total += 0.075 + 0.015;

  summary += `\n💰 Totale: ${total.toFixed(3)} €`;

  document.getElementById('orderSummary').style.display = 'block';
  document.getElementById('orderSummary').textContent = summary;
}

function generateStripeSummary() {
  const summary = document.getElementById("orderSummary").textContent;
  const maxLength = 500;
  if (summary.length <= maxLength) return summary;

  const date = document.querySelector('[name="delivery_date"]').value;
  const time = document.querySelector('[name="delivery_time"]').value;
  const phone = document.querySelector('[name="whatsapp"]').value;
  const count = document.querySelectorAll('.formule-block').length;

  return `Data: ${date} ${time}, Cliente: ${phone}, Formule: ${count}, Totale: ${summary.match(/Totale: ([\\d.,]+)/)?.[1]} €`;
}

document.getElementById("orderForm").addEventListener("submit", function(e) {
  e.preventDefault();
  const summary = document.getElementById("orderSummary").textContent;
  const totalMatch = summary.match(/Totale: ([\\d.,]+)/);
  const total = totalMatch ? parseFloat(totalMatch[1].replace(',', '.')) : 0;

  document.getElementById('toastOverlay').style.display = 'block';
  setTimeout(() => { document.getElementById('toastOverlay').style.display = 'none'; }, 8000);

  fetch('https://zielinska.onrender.com/create-checkout-session', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      total,
      phone: document.querySelector('[name="whatsapp"]').value,
      delivery_date: document.querySelector('[name="delivery_date"]').value,
      orderDetailsShort: generateStripeSummary(),
      orderDetailsLong: summary,
      source: "zielinska"
    })
  })
  .then(res => res.json())
  .then(data => {
    if (data.url) {
      window.location.href = data.url;
    } else {
      alert("❌ Pagamento non disponibile al momento. Riprova più tardi.");
    }
  })
  .catch(err => {
    console.error("❌ Errore:", err);
    alert("❌ Errore durante il pagamento.");
  });
});
</script>

</body>
</html>
